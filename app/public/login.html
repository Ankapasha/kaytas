<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-i18n="title">Login â€“ Kaytas</title>

  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: #f5f6f8; }

    /* Language selector */
    #langBox {
      text-align: right;
      padding: 10px 14px 0 14px;
      max-width: 1200px;
      margin: 0 auto;
    }
    #langSwitcher {
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
    }

    header {
      background: #fff;
      padding: 15px 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
    }

    header h1 { margin: 0; font-size: 22px; cursor: pointer; }

    #backHome {
      background: #ddd;
      border: none;
      padding: 8px 14px;
      border-radius: 6px;
      cursor: pointer;
    }

    .container {
      max-width: 1200px;
      margin: 40px auto;
      padding: 0 16px;
      display: flex;
      justify-content: center;
    }

    .card {
      background: #fff;
      width: 100%;
      max-width: 420px;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    h2 { text-align: center; margin-bottom: 25px; }

    .tabs {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }

    .tab-btn {
      flex: 1;
      padding: 10px;
      border-radius: 6px;
      cursor: pointer;
      border: none;
      font-weight: 600;
      background: #e8e8e8;
    }

    .tab-active { background: #1976d2; color: #fff; }

    form {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    input {
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 15px;
    }

    button[type="submit"] {
      padding: 12px;
      background: #1976d2;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
    }

    #registerSubmit { background: #28a745 !important; }

    .notice {
      color: #b30000;
      font-size: 14px;
      text-align: center;
      min-height: 20px;
    }

    footer {
      text-align: center;
      padding: 25px;
      color: #666;
      margin-top: 40px;
    }
  </style>
</head>

<body>

<!-- LANGUAGE DROPDOWN -->
<div id="langBox">
  <select id="langSwitcher">
    <option value="en">ðŸ‡¬ðŸ‡§ English</option>
    <option value="bs">ðŸ‡·ðŸ‡¸ Serbian (Latin)</option>
    <option value="de">ðŸ‡©ðŸ‡ª Deutsch</option>
    <option value="fr">ðŸ‡«ðŸ‡· FranÃ§ais</option>
    <option value="es">ðŸ‡ªðŸ‡¸ EspaÃ±ol</option>
    <option value="it">ðŸ‡®ðŸ‡¹ Italiano</option>
    <option value="sq">ðŸ‡¦ðŸ‡± Shqip</option>
  </select>
</div>

<header>
  <h1 onclick="location.href='/'">Kaytas</h1>
  <button id="backHome" data-i18n="back">Back</button>
</header>

<div class="container">
  <div class="card">

    <h2 data-i18n="login_register">Login / Register</h2>

    <!-- Tabs -->
    <div class="tabs">
      <button id="loginTab" class="tab-btn tab-active" data-i18n="login">Login</button>
      <button id="registerTab" class="tab-btn" data-i18n="register">Register</button>
    </div>

    <!-- LOGIN FORM -->
    <form id="loginForm">
      <input type="email" id="loginEmail" data-i18n-placeholder="email" required>
      <input type="password" id="loginPassword" data-i18n-placeholder="password" required>
      <button type="submit" data-i18n="login_btn">Login</button>
      <p id="loginMsg" class="notice"></p>
    </form>

    <!-- REGISTER FORM -->
    <form id="registerForm" style="display:none;">
      <input type="text" id="regName" data-i18n-placeholder="name" required>
      <input type="email" id="regEmail" data-i18n-placeholder="email" required>
      <input type="password" id="regPassword" data-i18n-placeholder="password" required>
      <button id="registerSubmit" type="submit" data-i18n="register_btn">Register</button>
      <p id="registerMsg" class="notice"></p>
    </form>

  </div>
</div>

<footer>
  Â© 2025 Kaytas
</footer>

<script>
/* -------------------------------------------
   LANGUAGE PACKS
-------------------------------------------- */
const LANG = {
  en: {
    title: "Login â€“ Kaytas",
    back: "Back",
    login_register: "Login / Register",
    login: "Login",
    register: "Register",
    email: "Email",
    password: "Password",
    name: "Name",
    login_btn: "Login",
    register_btn: "Register",
    wrong: "Incorrect details.",
    success_login: "Login successful!",
    success_register: "Registration successful!",
    server_error: "Server error."
  },
  bs: {
    title: "Prijava â€“ Kaytas",
    back: "Nazad",
    login_register: "Prijava / Registracija",
    login: "Prijava",
    register: "Registracija",
    email: "Email",
    password: "Lozinka",
    name: "Ime",
    login_btn: "Prijavi se",
    register_btn: "Registruj se",
    wrong: "PogreÅ¡ni podaci.",
    success_login: "UspjeÅ¡na prijava!",
    success_register: "Registracija uspjeÅ¡na!",
    server_error: "Serverska greÅ¡ka."
  },
  de: {
    title: "Login â€“ Kaytas",
    back: "ZurÃ¼ck",
    login_register: "Login / Registrieren",
    login: "Login",
    register: "Registrieren",
    email: "E-Mail",
    password: "Passwort",
    name: "Name",
    login_btn: "Login",
    register_btn: "Registrieren",
    wrong: "Falsche Daten.",
    success_login: "Login erfolgreich!",
    success_register: "Registrierung erfolgreich!",
    server_error: "Serverfehler."
  },
  fr: {
    title: "Connexion â€“ Kaytas",
    back: "Retour",
    login_register: "Connexion / Inscription",
    login: "Connexion",
    register: "Inscription",
    email: "Email",
    password: "Mot de passe",
    name: "Nom",
    login_btn: "Connexion",
    register_btn: "S'inscrire",
    wrong: "Informations incorrectes.",
    success_login: "Connexion rÃ©ussie!",
    success_register: "Inscription rÃ©ussie!",
    server_error: "Erreur serveur."
  },
  es: {
    title: "Iniciar SesiÃ³n â€“ Kaytas",
    back: "AtrÃ¡s",
    login_register: "Iniciar sesiÃ³n / Registrarse",
    login: "Iniciar sesiÃ³n",
    register: "Registrar",
    email: "Correo",
    password: "ContraseÃ±a",
    name: "Nombre",
    login_btn: "Entrar",
    register_btn: "Registrar",
    wrong: "Datos incorrectos.",
    success_login: "Â¡Inicio exitoso!",
    success_register: "Â¡Registro exitoso!",
    server_error: "Error del servidor."
  },
  it: {
    title: "Accesso â€“ Kaytas",
    back: "Indietro",
    login_register: "Accedi / Registrati",
    login: "Accedi",
    register: "Registrati",
    email: "Email",
    password: "Password",
    name: "Nome",
    login_btn: "Accedi",
    register_btn: "Registrati",
    wrong: "Dati errati.",
    success_login: "Accesso riuscito!",
    success_register: "Registrazione riuscita!",
    server_error: "Errore del server."
  },
  sq: {
    title: "Hyrja â€“ Kaytas",
    back: "Kthehu",
    login_register: "Hyr / Regjistrohu",
    login: "Hyr",
    register: "Regjistrohu",
    email: "Email",
    password: "FjalÃ«kalimi",
    name: "Emri",
    login_btn: "Hyr",
    register_btn: "Regjistrohu",
    wrong: "TÃ« dhÃ«na tÃ« pasakta.",
    success_login: "Hyrje me sukses!",
    success_register: "Regjistrim i suksesshÃ«m!",
    server_error: "Gabim serveri."
  }
};

function currentLang() {
  return localStorage.getItem("lang") || "en";
}

function applyLanguage(lang) {
  localStorage.setItem("lang", lang);
  const dict = LANG[lang];

  document.title = dict.title;

  document.querySelectorAll("[data-i18n]").forEach(el => {
    const key = el.getAttribute("data-i18n");
    el.textContent = dict[key] || "";
  });

  document.querySelectorAll("[data-i18n-placeholder]").forEach(el => {
    const key = el.getAttribute("data-i18n-placeholder");
    el.placeholder = dict[key] || "";
  });
}

function initLanguage() {
  const saved = currentLang();
  document.getElementById("langSwitcher").value = saved;
  document.getElementById("langSwitcher").addEventListener("change", e => {
    applyLanguage(e.target.value);
  });
  applyLanguage(saved);
}

initLanguage();

/* -------------------------------------------
   AUTH LOGIC
-------------------------------------------- */

const params = new URLSearchParams(window.location.search);
const redirectUrl = params.get("redirect") || "/dashboard.html";

loginTab.onclick = () => {
  loginTab.classList.add("tab-active");
  registerTab.classList.remove("tab-active");
  loginForm.style.display = "flex";
  registerForm.style.display = "none";
};

registerTab.onclick = () => {
  registerTab.classList.add("tab-active");
  loginTab.classList.remove("tab-active");
  loginForm.style.display = "none";
  registerForm.style.display = "flex";
};

document.getElementById("backHome").onclick = () => {
  window.location.href = "/";
};

loginForm.addEventListener("submit", async e => {
  e.preventDefault();
  const dict = LANG[currentLang()];

  try {
    const res = await fetch("/api/auth/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email: loginEmail.value, password: loginPassword.value })
    });

    const data = await res.json();
    if (!res.ok) return loginMsg.textContent = dict.wrong;

    localStorage.setItem("token", data.token);
    loginMsg.textContent = dict.success_login;
    setTimeout(() => window.location.href = redirectUrl, 500);

  } catch {
    loginMsg.textContent = dict.server_error;
  }
});

registerForm.addEventListener("submit", async e => {
  e.preventDefault();
  const dict = LANG[currentLang()];

  try {
    const res = await fetch("/api/auth/register", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        name: regName.value,
        email: regEmail.value,
        password: regPassword.value
      })
    });

    const data = await res.json();
    if (!res.ok) return registerMsg.textContent = dict.wrong;

    localStorage.setItem("token", data.token);
    registerMsg.textContent = dict.success_register;
    setTimeout(() => window.location.href = redirectUrl, 500);

  } catch {
    registerMsg.textContent = dict.server_error;
  }
});
</script>

</body>
</html>
